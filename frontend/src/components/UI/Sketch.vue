<template>
  <div class="sketch">
    <div
      :class="['sketch__header', {
        active: isOpen
      }]"
    >
      <div class="sketch__header-row">
        <div class="sketch__logo">
          <svg width="111" height="15" viewBox="0 0 111 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.08807 14.2045C4.26989 14.2045 3.54759 13.9979 2.92116 13.5845C2.29474 13.1669 1.80469 12.5788 1.45099 11.8203C1.0973 11.0575 0.920455 10.1562 0.920455 9.11648C0.920455 8.08523 1.0973 7.19034 1.45099 6.43182C1.80469 5.6733 2.29688 5.08736 2.92756 4.67401C3.55824 4.26065 4.28693 4.05398 5.11364 4.05398C5.75284 4.05398 6.25781 4.16051 6.62855 4.37358C7.00355 4.58239 7.28906 4.82102 7.48509 5.08949C7.68537 5.35369 7.84091 5.57102 7.9517 5.74148H8.07955V0.909091H9.58807V14H8.13068V12.4915H7.9517C7.84091 12.6705 7.68324 12.8963 7.47869 13.169C7.27415 13.4375 6.98224 13.6783 6.60298 13.8913C6.22372 14.1001 5.71875 14.2045 5.08807 14.2045ZM5.29261 12.8494C5.89773 12.8494 6.40909 12.6918 6.8267 12.3764C7.24432 12.0568 7.56179 11.6158 7.77912 11.0533C7.99645 10.4865 8.10511 9.83239 8.10511 9.09091C8.10511 8.35795 7.99858 7.71662 7.78551 7.1669C7.57244 6.61293 7.2571 6.18253 6.83949 5.87571C6.42188 5.56463 5.90625 5.40909 5.29261 5.40909C4.65341 5.40909 4.12074 5.57315 3.6946 5.90128C3.27273 6.22514 2.95526 6.66619 2.74219 7.22443C2.53338 7.77841 2.42898 8.40057 2.42898 9.09091C2.42898 9.78977 2.53551 10.4247 2.74858 10.9957C2.96591 11.5625 3.28551 12.0142 3.70739 12.3509C4.13352 12.6832 4.66193 12.8494 5.29261 12.8494ZM16.009 14.2045C15.1226 14.2045 14.3449 13.9936 13.6759 13.5717C13.0111 13.1499 12.4913 12.5597 12.1163 11.8011C11.7455 11.0426 11.5601 10.1562 11.5601 9.14205C11.5601 8.11932 11.7455 7.22656 12.1163 6.46378C12.4913 5.70099 13.0111 5.10866 13.6759 4.68679C14.3449 4.26491 15.1226 4.05398 16.009 4.05398C16.8954 4.05398 17.6709 4.26491 18.3357 4.68679C19.0047 5.10866 19.5246 5.70099 19.8954 6.46378C20.2704 7.22656 20.4579 8.11932 20.4579 9.14205C20.4579 10.1562 20.2704 11.0426 19.8954 11.8011C19.5246 12.5597 19.0047 13.1499 18.3357 13.5717C17.6709 13.9936 16.8954 14.2045 16.009 14.2045ZM16.009 12.8494C16.6823 12.8494 17.2363 12.6768 17.6709 12.3317C18.1056 11.9865 18.4273 11.5327 18.6361 10.9702C18.8449 10.4077 18.9493 9.7983 18.9493 9.14205C18.9493 8.4858 18.8449 7.87429 18.6361 7.30753C18.4273 6.74077 18.1056 6.28267 17.6709 5.93324C17.2363 5.58381 16.6823 5.40909 16.009 5.40909C15.3357 5.40909 14.7817 5.58381 14.3471 5.93324C13.9124 6.28267 13.5907 6.74077 13.3819 7.30753C13.1731 7.87429 13.0687 8.4858 13.0687 9.14205C13.0687 9.7983 13.1731 10.4077 13.3819 10.9702C13.5907 11.5327 13.9124 11.9865 14.3471 12.3317C14.7817 12.6768 15.3357 12.8494 16.009 12.8494Z" fill="black"/>
          <path d="M26.063 0.909091L28.9905 10.4972H29.0992L32.0268 0.909091H35.568L31.1511 14H26.9387L22.5218 0.909091H26.063ZM37.8579 14H34.4573L38.8742 0.909091H43.0866L47.5035 14H44.1029L41.0284 4.20739H40.9261L37.8579 14ZM37.4041 8.84801H44.512V11.2514H37.4041V8.84801ZM56.8327 0.909091H59.9904V9.35298C59.9904 10.3288 59.7581 11.179 59.2936 11.9034C58.8291 12.6236 58.1814 13.1818 57.3505 13.5781C56.5195 13.9702 55.5543 14.1662 54.4549 14.1662C53.3426 14.1662 52.3711 13.9702 51.5401 13.5781C50.7091 13.1818 50.0635 12.6236 49.6033 11.9034C49.1431 11.179 48.913 10.3288 48.913 9.35298V0.909091H52.077V9.07812C52.077 9.52983 52.175 9.93253 52.3711 10.2862C52.5713 10.6399 52.8505 10.9169 53.2084 11.1172C53.5664 11.3175 53.9818 11.4176 54.4549 11.4176C54.9279 11.4176 55.3412 11.3175 55.6949 11.1172C56.0529 10.9169 56.332 10.6399 56.5323 10.2862C56.7326 9.93253 56.8327 9.52983 56.8327 9.07812V0.909091ZM73.8563 5.65199H70.6603C70.6177 5.32386 70.5303 5.0277 70.3982 4.76349C70.2661 4.49929 70.0914 4.27344 69.8741 4.08594C69.6567 3.89844 69.3989 3.75568 69.1006 3.65767C68.8066 3.5554 68.4806 3.50426 68.1226 3.50426C67.4877 3.50426 66.9401 3.6598 66.4799 3.97088C66.0239 4.28196 65.6724 4.73153 65.4252 5.3196C65.1823 5.90767 65.0609 6.61932 65.0609 7.45455C65.0609 8.32386 65.1844 9.05256 65.4316 9.64062C65.683 10.2244 66.0346 10.6655 66.4863 10.9638C66.9423 11.2578 67.4813 11.4048 68.1035 11.4048C68.4529 11.4048 68.7704 11.3601 69.0559 11.2706C69.3457 11.1811 69.5992 11.0511 69.8165 10.8807C70.0381 10.706 70.2192 10.495 70.3599 10.2479C70.5048 9.99645 70.6049 9.71307 70.6603 9.39773L73.8563 9.4169C73.8009 9.99645 73.6326 10.5675 73.3513 11.13C73.0744 11.6925 72.693 12.206 72.2072 12.6705C71.7214 13.1307 71.129 13.4972 70.4302 13.7699C69.7356 14.0426 68.9387 14.179 68.0396 14.179C66.8549 14.179 65.7938 13.919 64.8563 13.3991C63.9231 12.875 63.1859 12.1122 62.6447 11.1108C62.1035 10.1094 61.8329 8.89062 61.8329 7.45455C61.8329 6.0142 62.1077 4.79332 62.6575 3.7919C63.2072 2.79048 63.9508 2.02983 64.8883 1.50994C65.8258 0.990056 66.8762 0.730113 68.0396 0.730113C68.8322 0.730113 69.5651 0.840909 70.2384 1.0625C70.9117 1.27983 71.504 1.59943 72.0154 2.02131C72.5268 2.43892 72.9423 2.95241 73.2619 3.56179C73.5815 4.17116 73.7796 4.8679 73.8563 5.65199ZM75.6669 14V0.909091H78.8309V6.16335H83.9893V0.909091H87.147V14H83.9893V8.73935H78.8309V14H75.6669ZM89.1317 14V0.909091H98.2595V3.47869H92.2958V6.16335H97.7929V8.73935H92.2958V11.4304H98.2595V14H89.1317ZM100.241 14V0.909091H105.649C106.629 0.909091 107.475 1.08594 108.186 1.43963C108.902 1.78906 109.454 2.2919 109.842 2.94815C110.23 3.60014 110.424 4.37358 110.424 5.26847C110.424 6.17614 110.225 6.94744 109.829 7.58239C109.433 8.21307 108.87 8.6946 108.142 9.02699C107.413 9.35511 106.55 9.51918 105.553 9.51918H102.133V7.02628H104.965C105.442 7.02628 105.841 6.96449 106.16 6.84091C106.484 6.71307 106.729 6.52131 106.895 6.26562C107.061 6.00568 107.144 5.6733 107.144 5.26847C107.144 4.86364 107.061 4.52912 106.895 4.26491C106.729 3.99645 106.484 3.79616 106.16 3.66406C105.836 3.5277 105.438 3.45952 104.965 3.45952H103.405V14H100.241ZM107.611 8.01705L110.871 14H107.419L104.223 8.01705H107.611Z" fill="#846BCB"/>
          </svg>
        </div>
        <div
          class="header__right desktop"
        >
          <div class="header__right-wrap">
            <div class="identity box" v-if="connection.userIdentity">
              <p
                class="identity__wallet"
                 v-text="userIdentityShort"
              >
              </p>
              <div class="identity__logout" @click="logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.5 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13.3333 14.1667L17.4999 10L13.3333 5.83334" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17.5 10H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
            <div class="identity box" v-else>
              Connect wallet
            </div>
          </div>
        </div>
        <div
          :class="['header__right mobile', {
            active: isOpen
          }]"
        >
          <div class="header__right-wrap">
            <div class="identity box" v-if="connection.userIdentity">
              <p
                class="identity__wallet"
                 v-text="userIdentityShort"
                 @click="isOpen = !isOpen"
              >
              </p>
            </div>
          </div>
        </div>
        <div class="header__mobile-menu" v-if="isOpen">
          <div class="header__mobile-menu__bg" @click="isOpen = false"></div>
          <div class="header__mobile-menu-inner">
            <div class="header__mobile-menu__item">
              <div class="identity__logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_81_719)">
                    <path d="M16.6667 7.5H9.16667C8.24619 7.5 7.5 8.24619 7.5 9.16667V16.6667C7.5 17.5871 8.24619 18.3333 9.16667 18.3333H16.6667C17.5871 18.3333 18.3333 17.5871 18.3333 16.6667V9.16667C18.3333 8.24619 17.5871 7.5 16.6667 7.5Z" stroke="#846BCB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4.16675 12.5H3.33341C2.89139 12.5 2.46746 12.3244 2.1549 12.0118C1.84234 11.6993 1.66675 11.2754 1.66675 10.8333V3.33332C1.66675 2.8913 1.84234 2.46737 2.1549 2.15481C2.46746 1.84225 2.89139 1.66666 3.33341 1.66666H10.8334C11.2754 1.66666 11.6994 1.84225 12.0119 2.15481C12.3245 2.46737 12.5001 2.8913 12.5001 3.33332V4.16666" stroke="#846BCB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                  <clipPath id="clip0_81_719">
                    <rect width="20" height="20" fill="white"/>
                  </clipPath>
                  </defs>
                </svg>
              </div>
              <span>Copy address</span>
            </div>
            <div class="header__mobile-menu__item" @click="logout">
              <div class="identity__logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.5 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13.3333 14.1667L17.4999 10L13.3333 5.83334" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17.5 10H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <span>Logout</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sketch__main" :class="$attrs.class">
      <slot></slot>
    </div>
    <div class="sketch__footer">
      © 2022 doNFT & Quantor, All Rights Reserved.
    </div>
  </div>
</template>

<script>
    export default {
        inheritAttrs: false
    }
</script>

<script setup>
    import {ref, onMounted, watch} from "vue";
    import {useStore} from "@/store/main";
    import {storeToRefs} from "pinia";
    import {ConnectionStore} from '@/crypto/helpers'
    import AppConnector from "@/crypto/AppConnector";
    const store = useStore()
    const {
        connection,
        userIdentityShort,
        getExplorerLink
    } = storeToRefs(store);
    const openContractManage = () => store.changeManageContractView(true)
    const logout = async () => {
        await ConnectionStore.logOut()
    }

    let userBalance = ref({})
    let isOpen = ref(false)

    watch(() => connection.value.userIdentity, (newValue) => {
        if (newValue) getUserBalance()

        if (!newValue) userBalance.value = {}
    })

    onMounted(() => {
      if (connection.value.userIdentity) getUserBalance()
    })

    const getUserBalance = async () => {
        try{
          const balance = await AppConnector.connector.fetchBalanceAmount()
          // console.log(balance, 'getUserBalance')
          userBalance.value = balance
        }
        catch (e) {
            console.log(e);
        }
    }
</script>